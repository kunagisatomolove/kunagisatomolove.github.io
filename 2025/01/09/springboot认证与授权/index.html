<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>springboot认证与授权 | 王建's 博客</title><meta name="author" content="王建,2200189658@qq.com"><meta name="copyright" content="王建"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="如果不理解oauth协议的推荐阅读 阮一峰的理解OAuth 2.0  当然，我们也要简单介绍下oauth的运行流程： 1234567891011121314151617+--------+                               +---------------+|        |--(A)- Authorization Request -&gt;|   Resource">
<meta property="og:type" content="article">
<meta property="og:title" content="springboot认证与授权">
<meta property="og:url" content="https://kunagisatomolove.github.io/2025/01/09/springboot%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/index.html">
<meta property="og:site_name" content="王建&#39;s 博客">
<meta property="og:description" content="如果不理解oauth协议的推荐阅读 阮一峰的理解OAuth 2.0  当然，我们也要简单介绍下oauth的运行流程： 1234567891011121314151617+--------+                               +---------------+|        |--(A)- Authorization Request -&gt;|   Resource">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://kunagisatomolove.github.io/wallpaper/images/d5dkgl.jpg">
<meta property="article:published_time" content="2025-01-09T07:01:20.000Z">
<meta property="article:modified_time" content="2025-01-09T07:03:36.199Z">
<meta property="article:author" content="王建">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="spring security">
<meta property="article:tag" content="oauth">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://kunagisatomolove.github.io/wallpaper/images/d5dkgl.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://kunagisatomolove.github.io/2025/01/09/springboot%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"WKJ29H8QCP","apiKey":"8a3d1333693ba0935df0a97b25d14121","indexName":"blog_index","hitsPerPage":6,"languages":{"input_placeholder":"搜索文章","hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'medium_zoom',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'springboot认证与授权',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://thirdqq.qlogo.cn/g?b=sdk&amp;nk=2200189658&amp;s=140" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fa fa-comments"></i><span> 在线说说</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comment"></i><span> 本地说说</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/wallpaper/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/wallpaper/images/d5dkgl.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">王建's 博客</span></a><a class="nav-page-title" href="/"><span class="site-name">springboot认证与授权</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fa fa-comments"></i><span> 在线说说</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comment"></i><span> 本地说说</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/wallpaper/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">springboot认证与授权</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-01-09T07:01:20.000Z" title="发表于 2025-01-09 15:01:20">2025-01-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-09T07:03:36.199Z" title="更新于 2025-01-09 15:03:36">2025-01-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">网络安全</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">1.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>7分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p>如果不理解oauth协议的推荐阅读 阮一峰的<a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html">理解OAuth 2.0</a></p>
</blockquote>
<p>当然，我们也要简单介绍下oauth的运行流程：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+--------+                               +---------------+</span><br><span class="line">|        |--(A)- Authorization Request -&gt;|   Resource    |</span><br><span class="line">|        |                               |     Owner     |</span><br><span class="line">|        |&lt;-(B)-- Authorization Grant ---|               |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |--(C)-- Authorization Grant --&gt;| Authorization |</span><br><span class="line">| Client |                               |     Server    |</span><br><span class="line">|        |&lt;-(D)----- Access Token -------|               |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |</span><br><span class="line">|        |                               +---------------+</span><br><span class="line">|        |--(E)----- Access Token ------&gt;|    Resource   |</span><br><span class="line">|        |                               |     Server    |</span><br><span class="line">|        |&lt;-(F)--- Protected Resource ---|               |</span><br><span class="line">+--------+                               +---------------+</span><br></pre></td></tr></table></figure>
<p>运行流程如下图，摘自RFC 6749。</p>
<ul>
<li>（A）用户打开客户端以后，客户端要求用户给予授权。</li>
<li>（B）用户同意给予客户端授权。</li>
<li>（C）客户端使用上一步获得的授权，向认证服务器申请令牌。</li>
<li>（D）认证服务器对客户端进行认证以后，确认无误，同意发放令牌。</li>
<li>（E）客户端使用令牌，向资源服务器申请获取资源。</li>
<li>（F）资源服务器确认令牌无误，同意向客户端开放资源。</li>
</ul>
<p>我们是对内的系统，并不需要那么复杂的流程，所以我们看下oauth的授权模式当中的密码模式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+----------+</span><br><span class="line">| Resource |</span><br><span class="line">|  Owner   |</span><br><span class="line">|          |</span><br><span class="line">+----------+</span><br><span class="line">     v</span><br><span class="line">     |    Resource Owner</span><br><span class="line">    (A) Password Credentials</span><br><span class="line">     |</span><br><span class="line">     v</span><br><span class="line">+---------+                                  +---------------+</span><br><span class="line">|         |&gt;--(B)---- Resource Owner -------&gt;|               |</span><br><span class="line">|         |         Password Credentials     | Authorization |</span><br><span class="line">| Client  |                                  |     Server    |</span><br><span class="line">|         |&lt;--(C)---- Access Token ---------&lt;|               |</span><br><span class="line">|         |    (w/ Optional Refresh Token)   |               |</span><br><span class="line">+---------+                                  +---------------+</span><br></pre></td></tr></table></figure>
<p>这里的流程相对就比较简单了：</p>
<p>（A）用户向客户端提供用户名和密码。</p>
<p>（B）客户端将用户名和密码发给认证服务器，向后者请求令牌。</p>
<p>（C）认证服务器确认无误后，向客户端提供访问令牌。</p>
<p>现在将简单的转换下思路：</p>
<ul>
<li>
<p><code>Resource Owner</code>：资源拥有者，拥有订单，购物车等数据的人，既用户</p>
</li>
<li>
<p><code>Client</code>：客户端，浏览器</p>
</li>
<li>
<p><code>Authorization Server</code>：认证服务器，也就是服务器咯。</p>
</li>
</ul>
<p>在此A、B、C三个流程就变成了：</p>
<p>（A）用户在浏览器输入用户名和密码。</p>
<p>（B）浏览器将用户名和密码发给服务器，向后者请求令牌（token）。</p>
<p>（C）服务器确认无误后，返回token给用户。</p>
<p>但是根据标准的流程，并没有验证码之类的容身之地。而<code>spring security oauth2</code> 给我们提供的只能是标准的流程，所以我们对代码进行一些适配，能够适应我们自己的需求。</p>
<h2 id="spring的部分源码">spring的部分源码</h2>
<p>我们先来看下<code>spring security oauth2</code>的部分源码</p>
<p>首先我们直接进行授权的时候，调用的url大概为：<code>http://localhost:8080/oauth/token?username=user_1&amp;password=123456&amp;grant_type=password&amp;scope=select&amp;client_id=client_2&amp;client_secret=123456</code>，那么授权肯定是与该链接相关联的。基于这个猜测，我们去寻找源码吧。</p>
<p>在<code>idea</code>中使用全局搜索，搜索 字符串<code>&quot;/oauth/token&quot;</code>（带着引号），发现了一个类，似乎与这个请求有关 <code>ClientCredentialsTokenEndpointFilter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientCredentialsTokenEndpointFilter</span> <span class="keyword">extends</span> <span class="title class_">AbstractAuthenticationProcessingFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">ClientCredentialsTokenEndpointFilter</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>(<span class="string">&quot;/oauth/token&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ClientCredentialsTokenEndpointFilter</span><br><span class="line">	---&gt; AbstractAuthenticationProcessingFilter</span><br><span class="line">		---&gt; GenericFilterBean</span><br><span class="line">			---&gt; Filter</span><br></pre></td></tr></table></figure>
<p>发现，这个类是一个 <code>Filter</code> 也就是过滤器，通过这个过滤器，过滤请求，那么，我们去看看<code>doFilter</code>方法咯，<code>doFilter</code> 在 <code>ClientCredentialsTokenEndpointFilter</code> 的父类 <code>AbstractAuthenticationProcessingFilter</code> 上。</p>
<p>我们看看<code>AbstractAuthenticationProcessingFilter</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span></span><br><span class="line">		<span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">HttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> (HttpServletRequest) req;</span><br><span class="line">	<span class="type">HttpServletResponse</span> <span class="variable">response</span> <span class="operator">=</span> (HttpServletResponse) res;</span><br><span class="line">       <span class="comment">// 如果不是认证的请求，直接下一个filter</span></span><br><span class="line">       <span class="comment">// 这里是怎么判断是否是下一个请求呢？</span></span><br><span class="line">       <span class="comment">// 答：看看url是不是上面ClientCredentialsTokenEndpointFilter 创建时传过来的url，也就是 /oauth/token</span></span><br><span class="line">	<span class="keyword">if</span> (!requiresAuthentication(request, response)) &#123;</span><br><span class="line">		chain.doFilter(request, response);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	Authentication authResult;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">// 调用attemptAuthentication 方法，返回一个 Authentication 的实现类，也就是认证信息，这个实现类非常重要！！！ </span></span><br><span class="line">		authResult = attemptAuthentication(request, response);</span><br><span class="line">           <span class="comment">// 如果找不到，那就没了</span></span><br><span class="line">		<span class="keyword">if</span> (authResult == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 调用成功的方法</span></span><br><span class="line">	successfulAuthentication(request, response, chain, authResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里最重要的方法<code>attemptAuthentication</code> 生成一个授权信息，能够返回，则证明登录已经成功了，所以真正的登录与这里有关。</p>
<p>我们回到<code>ClientCredentialsTokenEndpointFilter</code> 这个实现类里面看看<code>attemptAuthentication</code>方法吧</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Authentication <span class="title function_">attemptAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span><br><span class="line">		<span class="keyword">throws</span> AuthenticationException, IOException, ServletException &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ======精简没啥用的方法========</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 构造一个UsernamePasswordAuthenticationToken </span></span><br><span class="line">	<span class="type">UsernamePasswordAuthenticationToken</span> <span class="variable">authRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UsernamePasswordAuthenticationToken</span>(clientId,</span><br><span class="line">			clientSecret);</span><br><span class="line">	<span class="comment">// 调用认证方法进行认证</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">this</span>.getAuthenticationManager().authenticate(authRequest);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们通过添加断点可以发现 <code>this.getAuthenticationManager()</code> 是一个<code>ProviderManager</code> 对象，我们看下</p>
<p><code>this.getAuthenticationManager().authenticate()</code> 里面的 <code>authenticate</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderManager</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Authentication <span class="title function_">authenticate</span><span class="params">(Authentication authentication)</span></span><br><span class="line">        <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">Authentication</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (AuthenticationProvider provider : getProviders()) &#123;</span><br><span class="line">            <span class="comment">// 在一堆的provider中寻找到一个合适的授权提供者</span></span><br><span class="line">			<span class="keyword">if</span> (!provider.supports(toTest)) &#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 由授权提供者进行授权</span></span><br><span class="line">			result = provider.authenticate(authentication);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一路追踪到这里，我们发现，实际上，是通过<code>provider.supports(toTest)</code> 寻找一个合适的授权提供者，使用<code>provider.authenticate(authentication)</code>就行授权，而<code>supports</code> 的依据是通过之前生成的token来判断是否支持：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class&lt;?&gt; authentication)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> (UsernamePasswordAuthenticationToken.class</span><br><span class="line">			.isAssignableFrom(authentication));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们整理下这几个流程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ClientCredentialsTokenEndpointFilter.doFilter() </span><br><span class="line">	--&gt; AbstractAuthenticationProcessingFilter.attemptAuthentication()</span><br><span class="line">		--&gt; ProviderManager.authenticate()</span><br><span class="line">			--&gt; AuthenticationProvider.supports()</span><br><span class="line">			--&gt; AuthenticationProvider.authenticate()</span><br></pre></td></tr></table></figure>
<p>我们可以看到这里主要就是干了几件事情</p>
<ul>
<li>通过filter 确定登录要过滤的url</li>
<li>通过filter 确定生成的<code>AbstractAuthenticationToken</code> 比如 <code>UsernamePasswordAuthenticationToken</code></li>
<li>通过生成的<code>AbstractAuthenticationToken</code> 确定<code>AuthenticationProvider</code></li>
<li>通过<code>AuthenticationProvider</code> 最后调用 <code>authenticate()</code>方法最后进行授权</li>
</ul>
<p>最后通过<code>RequestMapping</code> 返回</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FrameworkEndpoint</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenEndpoint</span> <span class="keyword">extends</span> <span class="title class_">AbstractEndpoint</span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/oauth/token&quot;, method=RequestMethod.POST)</span></span><br><span class="line">	<span class="keyword">public</span> ResponseEntity&lt;OAuth2AccessToken&gt; <span class="title function_">postAccessToken</span><span class="params">(Principal principal, <span class="meta">@RequestParam</span></span></span><br><span class="line"><span class="params">	Map&lt;String, String&gt; parameters)</span> <span class="keyword">throws</span> HttpRequestMethodNotSupportedException &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="type">String</span> <span class="variable">clientId</span> <span class="operator">=</span> getClientId(principal);</span><br><span class="line">		<span class="type">ClientDetails</span> <span class="variable">authenticatedClient</span> <span class="operator">=</span> getClientDetailsService().loadClientByClientId(clientId);</span><br><span class="line"></span><br><span class="line">		<span class="type">TokenRequest</span> <span class="variable">tokenRequest</span> <span class="operator">=</span> getOAuth2RequestFactory().createTokenRequest(parameters, authenticatedClient);</span><br><span class="line"></span><br><span class="line">		<span class="type">OAuth2AccessToken</span> <span class="variable">token</span> <span class="operator">=</span> getTokenGranter().grant(tokenRequest.getGrantType(), tokenRequest);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> getResponse(token);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到这里主要就是干了几件事情</p>
<ul>
<li>通过filter 确定登录要过滤的url</li>
<li>通过filter 确定生成的<code>AbstractAuthenticationToken</code> 比如 <code>UsernamePasswordAuthenticationToken</code></li>
<li>通过生成的<code>AbstractAuthenticationToken</code> 确定<code>AuthenticationProvider</code></li>
<li>通过<code>AuthenticationProvider</code> 最后调用 <code>authenticate()</code>方法最后进行授权</li>
</ul>
<p>根据上面我们对自己对代码进行了一些封装</p>
<p>我们先来看<code>LoginAuthenticationFilter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginAuthenticationFilter</span> <span class="keyword">extends</span> <span class="title class_">UsernamePasswordAuthenticationFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AuthenticationTokenParser authenticationTokenParser;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Authentication <span class="title function_">attemptAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">AbstractAuthenticationToken</span> <span class="variable">authRequest</span>  <span class="operator">=</span>  authenticationTokenParser.parse(requestBody);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getAuthenticationManager().authenticate(authRequest);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAuthenticationTokenParser</span><span class="params">(AuthenticationTokenParser authenticationTokenParser)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.authenticationTokenParser = authenticationTokenParser;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的登录继承了<code>UsernamePasswordAuthenticationFilter</code>  里面写了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">UsernamePasswordAuthenticationFilter</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="built_in">super</span>(<span class="keyword">new</span> <span class="title class_">AntPathRequestMatcher</span>(<span class="string">&quot;/login&quot;</span>, <span class="string">&quot;POST&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是为什么登录的接口是<code>/login</code>的原因</p>
<p>我们再来看看生成<code>AbstractAuthenticationToken </code>的方法</p>
<p><code>AbstractAuthenticationToken authRequest = authenticationTokenParser.parse(requestBody);</code></p>
<p>这里决定了生成什么token，将会决定后面的<code>AuthenticationProvider</code></p>
<p>我们先来看<code>AdminAuthenticationProvider</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean supports(Class&lt;?&gt; authentication) &#123;</span><br><span class="line">    return AdminAuthenticationToken.class.isAssignableFrom(authentication);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里决定<code>AdminAuthenticationToken</code> 是通过<code>AdminAuthenticationProvider</code> 进行校验</p>
<p>再来看下完整的<code>AdminAuthenticationProvider</code> 你就知道验证码在哪里校验的了，是不是很简单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminAuthenticationProvider</span> <span class="keyword">extends</span> <span class="title class_">AbstractUserDetailsAuthenticationProvider</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> YamiUserDetailsService yamiUserDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> UserDetails <span class="title function_">retrieveUser</span><span class="params">(String username, Authentication authentication)</span> <span class="keyword">throws</span> BaseYamiAuth2Exception &#123;</span><br><span class="line">        UserDetails user;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            user = yamiUserDetailsService.loadUserByUsername(username);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UsernameNotFoundExceptionBase var6) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundExceptionBase</span>(<span class="string">&quot;账号或密码不正确&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!user.isEnabled()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundExceptionBase</span>(<span class="string">&quot;账号已被锁定,请联系管理员&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">additionalAuthenticationChecks</span><span class="params">(UserDetails sysUser, Authentication authentication)</span> <span class="keyword">throws</span> BaseYamiAuth2Exception &#123;</span><br><span class="line">        <span class="type">AdminAuthenticationToken</span> <span class="variable">adminAuthenticationToken</span> <span class="operator">=</span> (AdminAuthenticationToken) authentication;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">kaptchaKey</span> <span class="operator">=</span> SecurityConstants.SPRING_SECURITY_RESTFUL_IMAGE_CODE + adminAuthenticationToken.getSessionUUID();</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">kaptcha</span> <span class="operator">=</span> RedisUtil.get(kaptchaKey);</span><br><span class="line"></span><br><span class="line">        RedisUtil.del(kaptchaKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isBlank(adminAuthenticationToken.getImageCode()) || !adminAuthenticationToken.getImageCode().equalsIgnoreCase(kaptcha))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ImageCodeNotMatchExceptionBase</span>(<span class="string">&quot;验证码有误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">encodedPassword</span> <span class="operator">=</span> sysUser.getPassword();</span><br><span class="line">        <span class="type">String</span> <span class="variable">rawPassword</span> <span class="operator">=</span> authentication.getCredentials().toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 密码不正确</span></span><br><span class="line">        <span class="keyword">if</span> (!passwordEncoder.matches(rawPassword,encodedPassword))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BadCredentialsExceptionBase</span>(<span class="string">&quot;账号或密码不正确&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Authentication <span class="title function_">createSuccessAuthentication</span><span class="params">(Authentication authentication, UserDetails user)</span> &#123;</span><br><span class="line">        <span class="type">AdminAuthenticationToken</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AdminAuthenticationToken</span>(user, authentication.getCredentials());</span><br><span class="line">        result.setDetails(authentication.getDetails());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kunagisatomolove">王建</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://kunagisatomolove.github.io/2025/01/09/springboot%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/">https://kunagisatomolove.github.io/2025/01/09/springboot认证与授权/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://kunagisatomolove.github.io" target="_blank">王建's 博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/spring-security/">spring security</a><a class="post-meta__tags" href="/tags/oauth/">oauth</a></div><div class="post-share"><div class="social-share" data-image="/wallpaper/images/d5dkgl.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/wallpaper/images/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/wallpaper/images/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/wallpaper/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/wallpaper/images/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/09/%E5%8A%A9%E5%8A%9B%E5%86%9C%E4%B8%9A%E7%94%9F%E4%BA%A7%E7%9A%84%E5%86%9C%E6%B0%91%E5%B8%AE%E4%B8%80%E4%BD%93%E5%8C%96%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9FAPI%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/" title="助力农业生产的农民帮一体化服务系统API接口文档"><img class="cover" src="/wallpaper/images/1kdgpg.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">助力农业生产的农民帮一体化服务系统API接口文档</div></div><div class="info-2"><div class="info-item-1">InformationExchangePlatform API 接口文档–用户部分 1.1 API V1 接口说明  使用 HTTP Status Code 标识状态 数据返回格式统一使用 JSON 用户权限配置统一使用 shiro + jwt  1.1.1 支持的请求方法  GET（SELECT）：从服务器取出资源（一项或多项）。 POST（CREATE）：在服务器新建一个资源。 PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。 PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。 DELETE（DELETE）：从服务器删除资源。 HEAD：获取资源的元数据。 OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。  1.1.2...</div></div></div></a><a class="pagination-related" href="/2025/01/07/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="《TCP/IP网络编程》学习笔记"><img class="cover" src="/wallpaper/images/%E8%83%8C%E6%99%AF16.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">《TCP/IP网络编程》学习笔记</div></div><div class="info-2"><div class="info-item-1">TCP/IP网络编程 1.TCP套接字 1.1 相关函数  socket函数创建套接字 bind函数分配IP地址和端口号给套接字 listen函数，使套接字可接收客户端连接 accept函数，使其受理客户端请求 connect函数，使其从客户端发送连接请求 closesocket函数，关闭套接字  1.2 基于Windos的服务端  使用WSAStartup函数初始化套接字库(初始化Winsock库) 调用socket函数创建套接字 调用bind分配IP地址和端口号给套接字 调用listen函数使创建的套接字成为服务端的套接字并监听套接字 调用accept函数受理客户端连接请求 调用send函数向指定客户端传输数据 调用closesocket函数关闭套接字 调用WSACleanup归还库，使程序无法调用Winsock相关函数(注销Winsock库)  ![套接字步骤](/home/wj/图片/截图/截图 2023-05-08 09-53-58.png) 1.3...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/01/09/%E5%8A%A9%E5%8A%9B%E5%86%9C%E4%B8%9A%E7%94%9F%E4%BA%A7%E7%9A%84%E5%86%9C%E6%B0%91%E5%B8%AE%E4%B8%80%E4%BD%93%E5%8C%96%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9FAPI%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/" title="助力农业生产的农民帮一体化服务系统API接口文档"><img class="cover" src="/wallpaper/images/1kdgpg.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-09</div><div class="info-item-2">助力农业生产的农民帮一体化服务系统API接口文档</div></div><div class="info-2"><div class="info-item-1">InformationExchangePlatform API 接口文档–用户部分 1.1 API V1 接口说明  使用 HTTP Status Code 标识状态 数据返回格式统一使用 JSON 用户权限配置统一使用 shiro + jwt  1.1.1 支持的请求方法  GET（SELECT）：从服务器取出资源（一项或多项）。 POST（CREATE）：在服务器新建一个资源。 PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。 PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。 DELETE（DELETE）：从服务器删除资源。 HEAD：获取资源的元数据。 OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。  1.1.2...</div></div></div></a><a class="pagination-related" href="/2025/01/07/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%88%AA%E7%8F%AD%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/" title="微服务航班接口文档"><img class="cover" src="/wallpaper/images/rdwjj7.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-07</div><div class="info-item-2">微服务航班接口文档</div></div><div class="info-2"><div class="info-item-1">1. 用户微服务接口 1.1. API 接口说明  服务端已开启 CORS 跨域支持 API  认证统一使用 Token 认证 需要授权的 API ，必须在请求头中使用 Authorization 字段提供 token 令牌 使用 HTTP Status Code 标识状态 数据返回格式统一使用 JSON  1.1.1. 支持的请求方法  GET（SELECT）：从服务器取出资源（一项或多项）。 POST（CREATE）：在服务器新建一个资源。 PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。 PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。 DELETE（DELETE）：从服务器删除资源。 HEAD：获取资源的元数据。 OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。  1.1.2 返回信息以及状态码说明    状态码 含义 说明     200 OK 请求成功   201 CREATED 创建成功   204 DELETED 删除成功   400 BAD...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://thirdqq.qlogo.cn/g?b=sdk&amp;nk=2200189658&amp;s=140" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">王建</div><div class="author-info-description">早岁已知世事艰，仍许飞鸿荡云间</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kunagisatomolove"><i class="fab fa-github"></i><span>联系我</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/kunagisatomolove" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github" style="color: #hdhfbb;"></i></a><a class="social-icon" href="mailto:2200189658@qq.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #000000;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">我是来自南京信息工程大学-计算机科学与技术的一名Java程序员，这是我的第一个博客</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#spring%E7%9A%84%E9%83%A8%E5%88%86%E6%BA%90%E7%A0%81"><span class="toc-number">1.</span> <span class="toc-text">spring的部分源码</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/01/16/%E5%88%86%E5%B8%83%E5%BC%8F%E5%88%9D%E6%8E%A2/" title="分布式初探(区块链技术指南)"><img src="/wallpaper/images/p8qp3m.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式初探(区块链技术指南)"/></a><div class="content"><a class="title" href="/2025/01/16/%E5%88%86%E5%B8%83%E5%BC%8F%E5%88%9D%E6%8E%A2/" title="分布式初探(区块链技术指南)">分布式初探(区块链技术指南)</a><time datetime="2025-01-16T02:47:50.000Z" title="发表于 2025-01-16 10:47:50">2025-01-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/09/%E5%8A%A9%E5%8A%9B%E5%86%9C%E4%B8%9A%E7%94%9F%E4%BA%A7%E7%9A%84%E5%86%9C%E6%B0%91%E5%B8%AE%E4%B8%80%E4%BD%93%E5%8C%96%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9FAPI%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/" title="助力农业生产的农民帮一体化服务系统API接口文档"><img src="/wallpaper/images/1kdgpg.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="助力农业生产的农民帮一体化服务系统API接口文档"/></a><div class="content"><a class="title" href="/2025/01/09/%E5%8A%A9%E5%8A%9B%E5%86%9C%E4%B8%9A%E7%94%9F%E4%BA%A7%E7%9A%84%E5%86%9C%E6%B0%91%E5%B8%AE%E4%B8%80%E4%BD%93%E5%8C%96%E6%9C%8D%E5%8A%A1%E7%B3%BB%E7%BB%9FAPI%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/" title="助力农业生产的农民帮一体化服务系统API接口文档">助力农业生产的农民帮一体化服务系统API接口文档</a><time datetime="2025-01-09T07:02:34.000Z" title="发表于 2025-01-09 15:02:34">2025-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/09/springboot%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/" title="springboot认证与授权"><img src="/wallpaper/images/d5dkgl.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="springboot认证与授权"/></a><div class="content"><a class="title" href="/2025/01/09/springboot%E8%AE%A4%E8%AF%81%E4%B8%8E%E6%8E%88%E6%9D%83/" title="springboot认证与授权">springboot认证与授权</a><time datetime="2025-01-09T07:01:20.000Z" title="发表于 2025-01-09 15:01:20">2025-01-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/07/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="《TCP/IP网络编程》学习笔记"><img src="/wallpaper/images/%E8%83%8C%E6%99%AF16.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="《TCP/IP网络编程》学习笔记"/></a><div class="content"><a class="title" href="/2025/01/07/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="《TCP/IP网络编程》学习笔记">《TCP/IP网络编程》学习笔记</a><time datetime="2025-01-07T04:03:07.000Z" title="发表于 2025-01-07 12:03:07">2025-01-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/01/07/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%88%AA%E7%8F%AD%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/" title="微服务航班接口文档"><img src="/wallpaper/images/rdwjj7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="微服务航班接口文档"/></a><div class="content"><a class="title" href="/2025/01/07/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%88%AA%E7%8F%AD%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3/" title="微服务航班接口文档">微服务航班接口文档</a><time datetime="2025-01-07T02:32:42.000Z" title="发表于 2025-01-07 10:32:42">2025-01-07</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/wallpaper/images/d5dkgl.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2025 By 王建</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://kunagisatomolove.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>(() => {
  const panguFn = () => {
    if (typeof pangu === 'object') pangu.autoSpacingPage()
    else {
      btf.getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
        .then(() => {
          pangu.autoSpacingPage()
        })
    }
  }

  const panguInit = () => {
    if (false){
      GLOBAL_CONFIG_SITE.isPost && panguFn()
    } else {
      panguFn()
    }
  }

  btf.addGlobalFn('pjaxComplete', panguInit, 'pangu')
  document.addEventListener('DOMContentLoaded', panguInit)
})()</script><div class="js-pjax"><script>(async () => {
  const showKatex = () => {
    document.querySelectorAll('#article-container .katex').forEach(el => el.classList.add('katex-show'))
  }

  if (!window.katex_js_css) {
    window.katex_js_css = true
    await btf.getCSS('https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css')
    if (false) {
      await btf.getScript('https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js')
    }
  }

  showKatex()
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://wj-blog.zeabur.app',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://wj-blog.zeabur.app',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div></body></html>